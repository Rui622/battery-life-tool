<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品续航时间计算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        .result-value {
            font-size: 2.25rem; /* 36px */
            line-height: 2.5rem; /* 40px */
            font-weight: 700;
        }
        .result-unit {
            font-size: 1.125rem; /* 18px */
            line-height: 1.75rem; /* 28px */
            margin-left: 0.5rem;
            color: #6B7280;
        }
        .event-container {
            transition: opacity 0.3s ease-in-out;
        }
        .preset-btn {
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <!-- 标题 -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">产品续航时间计算器</h1>
            <p class="mt-2 text-lg text-gray-600">基于标准功耗模型，快速评估产品理论续航表现</p>
            <!-- 查看计算方法说明按钮 -->
            <div class="mt-4">
                <a href="methodology.html" class="inline-flex items-center text-indigo-600 hover:text-indigo-800 font-medium transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1.5" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z" />
                    </svg>
                    查看计算方法说明
                </a>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 左侧：参数输入区域 -->
            <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold mb-6 border-b pb-4">输入参数</h2>

                <!-- 电池参数 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">1. 电池参数 (Battery Parameters)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="nominalCapacity" class="block text-sm font-medium text-gray-700 mb-1">电池标称容量 (mAh)</label>
                            <input type="number" id="nominalCapacity" value="3200" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label for="usablePercentage" class="block text-sm font-medium text-gray-700 mb-1">可用容量百分比 (%)</label>
                            <input type="number" id="usablePercentage" value="79.1" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <p class="text-xs text-gray-500 mt-1">此为工程设定值，通常无需修改。</p>
                        </div>
                    </div>
                </div>

                <!-- 事件功耗 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">2. 短时事件功耗 (Event-Driven Consumption)</h3>
                    
                    <!-- 事件1: 电机 -->
                    <div id="motorEventContainer" class="event-container p-4 border rounded-lg mb-4 bg-gray-50">
                        <div class="flex justify-between items-center mb-2">
                            <p class="font-medium text-gray-800">事件 A: 电机动作</p>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="motorSwitch" class="sr-only peer" checked>
                                <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:bg-green-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="motorCurrent" class="block text-sm font-medium text-gray-600 mb-1">电流 (mA)</label>
                                <input type="number" id="motorCurrent" value="140" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                                <p class="text-xs text-gray-500 mt-1">此为工程设定值，通常无需修改。</p>
                            </div>
                            <div>
                                <label for="motorDuration" class="block text-sm font-medium text-gray-600 mb-1">单次时长 (秒)</label>
                                <input type="number" id="motorDuration" value="5" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="motorFrequency" class="block text-sm font-medium text-gray-600 mb-1">每日次数</label>
                                <input type="number" id="motorFrequency" value="10" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                        </div>
                    </div>

                    <!-- 事件2: 屏幕 -->
                    <div id="screenEventContainer" class="event-container p-4 border rounded-lg bg-gray-50">
                        <div class="flex justify-between items-center mb-2">
                             <p class="font-medium text-gray-800">事件 B: 屏幕点亮</p>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="screenSwitch" class="sr-only peer" checked>
                                <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:bg-green-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="screenCurrent" class="block text-sm font-medium text-gray-600 mb-1">电流 (mA)</label>
                                <input type="number" id="screenCurrent" value="28" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                                <p class="text-xs text-gray-500 mt-1">此为工程设定值，通常无需修改。</p>
                            </div>
                            <div>
                                <label for="screenDuration" class="block text-sm font-medium text-gray-600 mb-1">单次时长 (秒)</label>
                                <input type="number" id="screenDuration" value="10" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="screenFrequency" class="block text-sm font-medium text-gray-600 mb-1">每日次数</label>
                                <input type="number" id="screenFrequency" value="20" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 持续状态功耗 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">3. 持续状态功耗 (State-Based Consumption)</h3>
                    <div class="p-4 border rounded-lg bg-gray-50">
                        <p class="font-medium text-gray-800 mb-2">状态 A: 休眠</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                <label for="sleepCurrent" class="block text-sm font-medium text-gray-600 mb-1">电流 (mA)</label>
                                <input type="number" id="sleepCurrent" value="0.01" step="0.001" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                                <p class="text-xs text-gray-500 mt-1">此为工程设定值，通常无需修改。</p>
                            </div>
                            <div>
                                <label for="sleepDuration" class="block text-sm font-medium text-gray-600 mb-1">每日时长 (小时)</label>
                                <input type="number" id="sleepDuration" step="0.5" value="24" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 模型选择 -->
                <div>
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">4. 季节性模型参数</h3>
                     <div class="p-4 border rounded-lg bg-gray-50">
                        <!-- 参数预设 -->
                        <div class="mb-4 pb-4 border-b">
                             <label class="block text-sm font-medium text-gray-600 mb-2">参数预设</label>
                             <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                                <button id="preset84" class="preset-btn flex-1 py-2 px-3 border rounded-md text-sm font-medium">8+4 模式</button>
                                <button id="preset66" class="preset-btn flex-1 py-2 px-3 border rounded-md text-sm font-medium">6+6 模式</button>
                                <button id="preset48" class="preset-btn flex-1 py-2 px-3 border rounded-md text-sm font-medium">4+8 模式</button>
                                <button id="presetCustom" class="preset-btn flex-1 py-2 px-3 border rounded-md text-sm font-medium">自定义</button>
                             </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="workingMonths" class="block text-sm font-medium text-gray-600 mb-1">工作期 (月)</label>
                                <input type="range" id="workingMonths" min="0" max="12" value="8" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                <p class="text-center font-semibold text-indigo-600 mt-1"><span id="workingMonthsValue">8</span> 个月</p>
                            </div>
                            <div>
                               <label class="block text-sm font-medium text-gray-600 mb-1">休眠期 (月)</label>
                               <div class="w-full p-2 border border-gray-300 rounded-md bg-gray-100 shadow-sm text-center font-semibold text-gray-700">
                                   <span id="sleepingMonthsValue">4</span> 个月
                               </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右侧：结果显示区域 -->
            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-2xl shadow-lg sticky top-8">
                    <h2 class="text-2xl font-bold mb-6 border-b pb-4 text-center">计算结果</h2>
                    
                    <div id="results-area">
                        <!-- 连续工作模型结果 -->
                        <div class="mb-8 text-center bg-indigo-50 p-6 rounded-xl border border-indigo-200">
                            <h3 class="text-lg font-semibold text-indigo-800 mb-2">模型A: 连续工作模式</h3>
                            <p class="text-indigo-600">模拟全年高频使用</p>
                            <div class="mt-4 flex items-baseline justify-center text-indigo-900">
                                <span id="lifeModelA" class="result-value">0</span>
                                <span class="result-unit">天</span>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">日均耗电: <span id="dailyConsumptionModelA" class="font-semibold">0</span> mAh/天</p>
                        </div>
                        
                        <!-- 季节性工作模型结果 -->
                        <div class="text-center bg-teal-50 p-6 rounded-xl border border-teal-200">
                            <h3 class="text-lg font-semibold text-teal-800 mb-2">模型B: 季节性工作模式</h3>
                             <p class="text-teal-600">模拟"工作+休眠"周期</p>
                            <div class="mt-4 flex items-baseline justify-center text-teal-900">
                                <span id="lifeModelB" class="result-value">0</span>
                                <span class="result-unit">天</span>
                            </div>
                             <p class="text-sm text-gray-500 mt-2">年度平均日耗电: <span id="dailyConsumptionModelB" class="font-semibold">0</span> mAh/天</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM 元素获取 ---
        const inputs = {
            nominalCapacity: document.getElementById('nominalCapacity'),
            usablePercentage: document.getElementById('usablePercentage'),
            motorCurrent: document.getElementById('motorCurrent'),
            motorDuration: document.getElementById('motorDuration'),
            motorFrequency: document.getElementById('motorFrequency'),
            screenCurrent: document.getElementById('screenCurrent'),
            screenDuration: document.getElementById('screenDuration'),
            screenFrequency: document.getElementById('screenFrequency'),
            sleepCurrent: document.getElementById('sleepCurrent'),
            sleepDuration: document.getElementById('sleepDuration'),
            workingMonths: document.getElementById('workingMonths'),
            motorSwitch: document.getElementById('motorSwitch'),
            screenSwitch: document.getElementById('screenSwitch'),
        };

        const displays = {
            workingMonthsValue: document.getElementById('workingMonthsValue'),
            sleepingMonthsValue: document.getElementById('sleepingMonthsValue'),
            lifeModelA: document.getElementById('lifeModelA'),
            dailyConsumptionModelA: document.getElementById('dailyConsumptionModelA'),
            lifeModelB: document.getElementById('lifeModelB'),
            dailyConsumptionModelB: document.getElementById('dailyConsumptionModelB'),
        };
        
        const containers = {
            motorEvent: document.getElementById('motorEventContainer'),
            screenEvent: document.getElementById('screenEventContainer'),
        };

        const presetButtons = {
            preset84: document.getElementById('preset84'),
            preset66: document.getElementById('preset66'),
            preset48: document.getElementById('preset48'),
            presetCustom: document.getElementById('presetCustom'),
        };

        /**
         * 主计算函数
         */
        function calculateBatteryLife() {
            // --- 1. 获取所有输入值 ---
            const nominalCapacity = parseFloat(inputs.nominalCapacity.value) || 0;
            const usablePercentage = parseFloat(inputs.usablePercentage.value) || 0;
            const motorCurrent = parseFloat(inputs.motorCurrent.value) || 0;
            const motorDuration = parseFloat(inputs.motorDuration.value) || 0;
            const motorFrequency = parseFloat(inputs.motorFrequency.value) || 0;
            const screenCurrent = parseFloat(inputs.screenCurrent.value) || 0;
            const screenDuration = parseFloat(inputs.screenDuration.value) || 0;
            const screenFrequency = parseFloat(inputs.screenFrequency.value) || 0;
            const sleepCurrent = parseFloat(inputs.sleepCurrent.value) || 0; 
            let sleepDuration = parseFloat(inputs.sleepDuration.value) || 0;
            const workingMonths = parseInt(inputs.workingMonths.value, 10);
            const isMotorEnabled = inputs.motorSwitch.checked;
            const isScreenEnabled = inputs.screenSwitch.checked;
            
            // --- 2. 核心计算逻辑 ---
            const totalUsableCapacity = nominalCapacity * (usablePercentage / 100);
            const motorConsumption = isMotorEnabled ? motorCurrent * (motorDuration / 3600) * motorFrequency : 0;
            const screenConsumption = isScreenEnabled ? screenCurrent * (screenDuration / 3600) * screenFrequency : 0;
            const sleepConsumption = sleepCurrent * sleepDuration;
            
            // 模型A
            const dailyConsumptionModelA = motorConsumption + screenConsumption + sleepConsumption;
            const lifeModelA = dailyConsumptionModelA > 0 ? totalUsableCapacity / dailyConsumptionModelA : 0;
            
            // 模型B
            const C_active = dailyConsumptionModelA;
            const C_sleep = sleepConsumption;
            const sleepMonths = 12 - workingMonths;
            const daysInMonth = 30.4;
            const annualConsumption = (C_active * workingMonths * daysInMonth) + (C_sleep * sleepMonths * daysInMonth);
            const dailyConsumptionModelB = annualConsumption / 365;
            const lifeModelB = dailyConsumptionModelB > 0 ? totalUsableCapacity / dailyConsumptionModelB : 0;
            
            // --- 3. 更新界面显示 ---
            updateUI(lifeModelA, dailyConsumptionModelA, lifeModelB, dailyConsumptionModelB, workingMonths, isMotorEnabled, isScreenEnabled);
        }

        /**
         * 更新UI界面函数
         */
        function updateUI(lifeA, consumptionA, lifeB, consumptionB, wm, motorOn, screenOn) {
            displays.lifeModelA.textContent = Math.round(lifeA).toLocaleString();
            displays.dailyConsumptionModelA.textContent = consumptionA.toFixed(3);
            displays.lifeModelB.textContent = Math.round(lifeB).toLocaleString();
            displays.dailyConsumptionModelB.textContent = consumptionB.toFixed(3);
            displays.workingMonthsValue.textContent = wm;
            displays.sleepingMonthsValue.textContent = 12 - wm;
            containers.motorEvent.style.opacity = motorOn ? 1 : 0.5;
            containers.screenEvent.style.opacity = screenOn ? 1 : 0.5;
            updatePresetButtons(wm);
        }
        
        /**
         * 更新预设按钮的激活状态
         */
        function updatePresetButtons(workingMonths) {
            // Reset all buttons to inactive state
            Object.values(presetButtons).forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white', 'border-transparent');
                btn.classList.add('bg-white', 'text-gray-700', 'border-gray-300', 'hover:bg-gray-100');
            });

            let activePreset = null;
            if (workingMonths === 8) activePreset = presetButtons.preset84;
            else if (workingMonths === 6) activePreset = presetButtons.preset66;
            else if (workingMonths === 4) activePreset = presetButtons.preset48;
            else activePreset = presetButtons.presetCustom;
            
            if (activePreset) {
                // Style the active button
                activePreset.classList.add('bg-indigo-600', 'text-white', 'border-transparent');
                activePreset.classList.remove('bg-white', 'text-gray-700', 'border-gray-300', 'hover:bg-gray-100');
            }
        }

        // --- 事件监听 ---
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', calculateBatteryLife);
        });
        
        inputs.sleepDuration.addEventListener('change', () => {
            let value = parseFloat(inputs.sleepDuration.value);
            if (value > 24) inputs.sleepDuration.value = 24;
            if (value < 0) inputs.sleepDuration.value = 0;
            calculateBatteryLife();
        });

        presetButtons.preset84.addEventListener('click', () => {
            inputs.workingMonths.value = 8;
            calculateBatteryLife();
        });
        presetButtons.preset66.addEventListener('click', () => {
            inputs.workingMonths.value = 6;
            calculateBatteryLife();
        });
        presetButtons.preset48.addEventListener('click', () => {
            inputs.workingMonths.value = 4;
            calculateBatteryLife();
        });
        presetButtons.presetCustom.addEventListener('click', () => {
            if (inputs.workingMonths.value % 2 !== 0 && ![4,6,8].includes(parseInt(inputs.workingMonths.value))) {
                // do nothing if already custom
            } else {
                 inputs.workingMonths.value = 12;
            }
            calculateBatteryLife();
        });

        // 页面加载后立即执行一次计算
        document.addEventListener('DOMContentLoaded', calculateBatteryLife);
    </script>
</body>
</html>
